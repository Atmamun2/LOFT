{% extends "base.html" %}

{% block title %}All Houses - Citadel Dynasty{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="page-header">
    <div class="header-content-row">
        <div>
            <h1 class="page-title">All Houses</h1>
            <p class="page-subtitle">Browse all registered family dynasties</p>
        </div>
        <div class="header-actions">
            <a href="{{ url_for('add_house') }}" class="btn btn-primary">
                <span class="btn-icon">[+]</span> Add New House
            </a>
        </div>
    </div>
</section>

<!-- Filters and Search -->
<section class="filters-section">
    <form method="GET" action="{{ url_for('houses') }}" class="filters-form">
        <div class="filter-group">
            <label for="search">Search:</label>
            <input 
                type="text" 
                id="search" 
                name="search" 
                placeholder="Search by house name or founder..."
                value="{{ request.args.get('search', '') }}"
                class="filter-input"
            >
        </div>
        
        <div class="filter-group">
            <label for="status">Status:</label>
            <select id="status" name="status" class="filter-select">
                <option value="">All</option>
                <option value="Active" {% if request.args.get('status') == 'Active' %}selected{% endif %}>Active</option>
                <option value="Merged" {% if request.args.get('status') == 'Merged' %}selected{% endif %}>Merged</option>
                <option value="Disbanded" {% if request.args.get('status') == 'Disbanded' %}selected{% endif %}>Disbanded</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label for="sort">Sort By:</label>
            <select id="sort" name="sort" class="filter-select">
                <option value="net_worth_desc" {% if request.args.get('sort') == 'net_worth_desc' %}selected{% endif %}>Net Worth (High to Low)</option>
                <option value="net_worth_asc" {% if request.args.get('sort') == 'net_worth_asc' %}selected{% endif %}>Net Worth (Low to High)</option>
                <option value="name_asc" {% if request.args.get('sort') == 'name_asc' %}selected{% endif %}>Name (A-Z)</option>
                <option value="name_desc" {% if request.args.get('sort') == 'name_desc' %}selected{% endif %}>Name (Z-A)</option>
                <option value="date_desc" {% if request.args.get('sort') == 'date_desc' %}selected{% endif %}>Newest First</option>
                <option value="date_asc" {% if request.args.get('sort') == 'date_asc' %}selected{% endif %}>Oldest First</option>
            </select>
        </div>
        
        <div class="filter-actions">
            <button type="submit" class="btn btn-secondary">Apply Filters</button>
            <a href="{{ url_for('houses') }}" class="btn btn-outline">Clear</a>
        </div>
    </form>
</section>

<!-- Results Summary -->
<section class="results-summary">
    <p>Showing {{ houses|length }} 
    {% if request.args.get('search') or request.args.get('status') %}
        of {{ total_houses }}
    {% endif %}
    house{% if houses|length != 1 %}s{% endif %}</p>
</section>

<!-- Houses Table (Desktop) -->
<section class="houses-table-section desktop-only">
    {% if houses %}
    <table class="houses-table">
        <thead>
            <tr>
                <th>House Name</th>
                <th>Founder</th>
                <th>Founded</th>
                <th>Members</th>
                <th>Net Worth</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for house in houses %}
            <tr>
                <td class="house-name-cell">
                    <a href="{{ url_for('house_detail', house_id=house.id) }}" class="house-link">
                        {{ house.name }}
                    </a>
                </td>
                <td>{{ house.founder_name }}</td>
                <td>{{ house.founded_date }}</td>
                <td>
                    <span class="member-count">
                        {{ house.active_members }}/{{ house.member_count }}
                    </span>
                    <span class="member-label">active</span>
                </td>
                <td class="currency-cell">
                    ${{ "{:,.2f}".format(house.net_worth) }}
                </td>
                <td>
                    <span class="status-badge status-{{ house.status|lower }}">
                        {{ house.status }}
                    </span>
                </td>
                <td class="actions-cell">
                    <a href="{{ url_for('house_detail', house_id=house.id) }}" class="btn btn-small" aria-label="View {{ house.name }}">View</a>
                    <a href="{{ url_for('edit_house', house_id=house.id) }}" class="btn btn-small" aria-label="Edit {{ house.name }}">Edit</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">[üèõÔ∏è]</div>
        <h3>No Houses Found</h3>
        <p>{% if request.args.get('search') or request.args.get('status') %}
            Try adjusting your filters or search terms.
        {% else %}
            No houses have been created yet. Be the first!
        {% endif %}</p>
        {% if not (request.args.get('search') or request.args.get('status')) %}
        <a href="{{ url_for('add_house') }}" class="btn btn-primary">Create First House</a>
        {% else %}
        <a href="{{ url_for('houses') }}" class="btn btn-secondary">Clear Filters</a>
        {% endif %}
    </div>
    {% endif %}
</section>

<!-- Houses Cards (Mobile) -->
<section class="houses-cards-section mobile-only">
    {% if houses %}
    <div class="houses-cards">
        {% for house in houses %}
        <article class="house-card-compact" aria-labelledby="house-{{ house.id }}-title-mobile">
            <div class="card-compact-header">
                <h3 id="house-{{ house.id }}-title-mobile">
                    <a href="{{ url_for('house_detail', house_id=house.id) }}">{{ house.name }}</a>
                </h3>
                <span class="status-badge status-{{ house.status|lower }}">{{ house.status }}</span>
            </div>
            
            <div class="card-compact-body">
                <div class="compact-row">
                    <span class="compact-label">Founder:</span>
                    <span class="compact-value">{{ house.founder_name }}</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">Founded:</span>
                    <span class="compact-value">{{ house.founded_date }}</span>
                </div>
                <div class="compact-row">
                    <span class="compact-label">Members:</span>
                    <span class="compact-value">{{ house.active_members }}/{{ house.member_count }} active</span>
                </div>
                <div class="compact-row highlight">
                    <span class="compact-label">Net Worth:</span>
                    <span class="compact-value">${{ "{:,.2f}".format(house.net_worth) }}</span>
                </div>
            </div>
            
            <div class="card-compact-actions">
                <a href="{{ url_for('house_detail', house_id=house.id) }}" class="btn btn-small btn-block">View Details</a>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">[üèõÔ∏è]</div>
        <h3>No Houses Found</h3>
        <p>{% if request.args.get('search') or request.args.get('status') %}
            Try adjusting your filters.
        {% else %}
            Be the first to create a house!
        {% endif %}</p>
        <a href="{{ url_for('add_house') }}" class="btn btn-primary">Create House</a>
    </div>
    {% endif %}
</section>

<!-- Pagination (if implemented) -->
{% if pagination %}
<nav class="pagination" aria-label="Page navigation">
    <div class="pagination-info">
        Page {{ pagination.page }} of {{ pagination.pages }}
    </div>
    <div class="pagination-controls">
        {% if pagination.has_prev %}
        <a href="{{ url_for('houses', page=pagination.prev_num, **request.args) }}" class="btn btn-outline">
            ‚Üê Previous
        </a>
        {% else %}
        <button class="btn btn-outline" disabled>‚Üê Previous</button>
        {% endif %}
        
        {% if pagination.has_next %}
        <a href="{{ url_for('houses', page=pagination.next_num, **request.args) }}" class="btn btn-outline">
            Next ‚Üí
        </a>
        {% else %}
        <button class="btn btn-outline" disabled>Next ‚Üí</button>
        {% endif %}
    </div>
</nav>
{% endif %}

<!-- Statistics Summary -->
<section class="statistics-section">
    <h2 class="section-title">Overall Statistics</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-card-header">Total Houses</div>
            <div class="stat-card-value">{{ total_houses }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-header">Active Houses</div>
            <div class="stat-card-value">{{ active_houses }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-header">Total Members</div>
            <div class="stat-card-value">{{ total_members }}</div>
        </div>
        <div class="stat-card">
            <div class="stat-card-header">Combined Net Worth</div>
            <div class="stat-card-value">${{ "{:,.0f}".format(total_net_worth) }}</div>
        </div>
    </div>
</section>

<style>
/* Additional styles specific to this page */
.page-header {
    margin-bottom: var(--spacing-xl);
    border-bottom: 2px solid var(--color-border);
    padding-bottom: var(--spacing-lg);
}

.header-content-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.page-title {
    font-size: 2rem;
    margin-bottom: var(--spacing-xs);
}

.page-subtitle {
    color: var(--color-secondary);
}

.filters-section {
    border: 2px solid var(--color-border);
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

.filters-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    align-items: end;
}

.filter-group {
    display: flex;
    flex-direction: column;
}

.filter-group label {
    font-weight: bold;
    margin-bottom: var(--spacing-xs);
    font-size: 0.9rem;
}

.filter-input,
.filter-select {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 2px solid var(--color-border);
    font-family: var(--font-mono);
    font-size: 12px;
}

.filter-actions {
    display: flex;
    gap: var(--spacing-sm);
}

.results-summary {
    margin-bottom: var(--spacing-lg);
    color: var(--color-secondary);
}

.houses-table {
    width: 100%;
    border: 2px solid var(--color-border);
    border-collapse: collapse;
    margin-bottom: var(--spacing-xl);
}

.houses-table th,
.houses-table td {
    border: 1px solid var(--color-border);
    padding: var(--spacing-sm) var(--spacing-md);
    text-align: left;
}

.houses-table th {
    background: var(--color-bg-dark);
    font-weight: bold;
}

.houses-table tbody tr:hover {
    background: var(--color-bg-light);
}

.house-link {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: bold;
}

.house-link:hover {
    text-decoration: underline;
}

.member-count {
    font-weight: bold;
}

.member-label {
    font-size: 0.8rem;
    color: var(--color-secondary);
}

.currency-cell {
    font-weight: bold;
    text-align: right;
}

.actions-cell {
    white-space: nowrap;
}

.btn-small {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: 0.9rem;
}

.btn-block {
    display: block;
    width: 100%;
    text-align: center;
}

.houses-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--spacing-lg);
}

.house-card-compact {
    border: 2px solid var(--color-border);
}

.card-compact-header {
    background: var(--color-bg-dark);
    border-bottom: 2px solid var(--color-border);
    padding: var(--spacing-md);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-compact-header h3 {
    margin: 0;
    font-size: 1rem;
}

.card-compact-header a {
    color: var(--color-primary);
    text-decoration: none;
}

.card-compact-body {
    padding: var(--spacing-md);
}

.compact-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: var(--spacing-xs);
    padding: var(--spacing-xs) 0;
    border-bottom: 1px solid var(--color-border);
}

.compact-row.highlight {
    font-weight: bold;
    border-bottom: 2px solid var(--color-border);
}

.compact-label {
    color: var(--color-secondary);
    font-size: 0.9rem;
}

.compact-value {
    text-align: right;
}

.card-compact-actions {
    border-top: 2px solid var(--color-border);
    padding: var(--spacing-md);
}

.pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 2px solid var(--color-border);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-xl);
}

.pagination-controls {
    display: flex;
    gap: var(--spacing-sm);
}

.statistics-section {
    margin-top: var(--spacing-xl);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-lg);
}

.stat-card {
    border: 2px solid var(--color-border);
    padding: var(--spacing-lg);
    text-align: center;
}

.stat-card-header {
    font-size: 0.9rem;
    color: var(--color-secondary);
    margin-bottom: var(--spacing-sm);
}

.stat-card-value {
    font-size: 2rem;
    font-weight: bold;
}

/* Responsive visibility */
.desktop-only {
    display: block;
}

.mobile-only {
    display: none;
}

@media (max-width: 768px) {
    .desktop-only {
        display: none;
    }
    
    .mobile-only {
        display: block;
    }
    
    .header-content-row {
        flex-direction: column;
        gap: var(--spacing-md);
        align-items: flex-start;
    }
    
    .filters-form {
        grid-template-columns: 1fr;
    }
    
    .filter-actions {
        flex-direction: column;
    }
    
    .pagination {
        flex-direction: column;
        gap: var(--spacing-md);
    }
}
</style>
{% endblock %}